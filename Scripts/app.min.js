function isSmartPhone(){return navigator.userAgent.indexOf("iPhone")>0&&navigator.userAgent.indexOf("iPad")==-1||navigator.userAgent.indexOf("iPod")>0||navigator.userAgent.indexOf("Android")>0}isSmartPhone()&&(document.body.style.fontSize="20px"),angular.module("albus",["ui"]).directive("autoComplete",function(){return function(n,t,i){n.$watch(i.uiItems,function(n){t.autocomplete({source:n,select:function(){setTimeout(function(){t.trigger("input")},0)}})},!0)}});var app;(function(n){var t=function(){function n(n,t){var i=this;this.showMap(n,t),n.busstops=[],n.busstopMarkers=[],t.jsonp("http://www9264ui.sakura.ne.jp/busstops/result_bts_lines?format=json&format=js&callback=JSON_CALLBACK").success(function(t){for(var r=0;r<t.busstops.length;r++)n.busstops.push(t.busstops[r].busstopname);i.busstopList=t.busstops,i.putMarkers(n)}),n.fromBusStop="昭和通り",n.toBusStop="五分一西",n.startTime=this.getNowTime(),n.resultDiagrams=[],n.swapBusstop=function(){var t=n.toBusStop;n.toBusStop=n.fromBusStop,n.fromBusStop=t},n.setFromBusStop=function(){n.fromBusStop=n.currentMarker.title},n.setToBusStop=function(){n.toBusStop=n.currentMarker.title},n.openMarkerInfo=function(t){n.currentMarker=t,n.busstopInfoWindow.open(n.myMap,t)},n.mapOptions={zoom:15,mapTypeId:google.maps.MapTypeId.ROADMAP},n.search=function(){i.searchBusStop(n,t)}}return n.prototype.searchBusStop=function(n,t){var i=this;t.jsonp("http://www9264ui.sakura.ne.jp/diagrams/result?start_busstopnm="+encodeURIComponent(n.fromBusStop)+"&arrival_busstopnm="+encodeURIComponent(n.toBusStop)+"&departure_datetime="+this.getNowDate()+n.startTime+"&format=js&callback=JSON_CALLBACK").success(function(r){n.resultDiagrams=[],n.resultDiagrams.push(i.formatResult(r.diagrams));var u=parseInt(r.diagrams[0].diagram.avltime,10)+1,f=i.padZero(u);t.jsonp("http://www9264ui.sakura.ne.jp/diagrams/result?start_busstopnm="+encodeURIComponent(n.fromBusStop)+"&arrival_busstopnm="+encodeURIComponent(n.toBusStop)+"&departure_datetime="+i.getNowDate()+f+"&format=js&callback=JSON_CALLBACK").success(function(t){n.resultDiagrams.push(i.formatResult(t.diagrams))}).error(function(n){console.log("fail"),console.log(n)})}).error(function(n){console.log("fail"),console.log(n)})},n.prototype.formatResult=function(n){return{linename:n[1].diagram.linename,from:this.formatTime(n[0].diagram.avltime),to:this.formatTime(n[1].diagram.avltime)}},n.prototype.formatTime=function(n){return n.substring(2,0)+":"+n.substring(4,2)},n.prototype.padZero=function(n){return n<1e3?"0"+n:n.toString()},n.prototype.putMarkers=function(n){for(var t=0;t<this.busstopList.length;t++)this.busstopList[t].marker||(this.busstopList[t].marker=this.putMarker(this.busstopList[t],n))},n.prototype.putMarker=function(n,t){var i=new google.maps.Marker({map:t.myMap,title:n.busstopname,position:new google.maps.LatLng(n.gps1,n.gps2),icon:"Images/busstop.png"});return t.busstopMarkers.push(i),i},n.prototype.getNowTime=function(){var i=new Date,n="",r=i.getHours(),t;return r<10&&(n+="0"),n+=r.toString(),t=i.getMinutes(),t<10&&(n+="0"),n+t.toString()},n.prototype.getNowDate=function(){var t=new Date,n="",u=t.getFullYear(),i,r;return n+=u.toString(),i=t.getMonth(),i<10&&(n+="0"),n+=i.toString(),r=t.getMonth(),r<10&&(n+="0"),n+r.toString()},n.prototype.showMap=function(n){var t=this,i=navigator.geolocation.watchPosition(function(i){var r=new google.maps.LatLng(i.coords.latitude,i.coords.longitude);n.myMap.setCenter(r),t.currentPosMarker||(t.currentPosMarker=new google.maps.Marker({map:n.myMap,title:"現在地",icon:"Images/male.png"})),t.currentPosMarker.setPosition(r)},function(n){switch(n.code){case 1:alert("位置情報の利用が許可されていません");break;case 2:alert("デバイスの位置が判定できません");break;case 3:alert("タイムアウトしました")}},{enableHighAccuracy:!0})},n.toggleMap=function(){var n=$("#map_canvas");n.css("display")==="none"?n.css("display","block"):n.css("display","none")},n}();n.searchBusByFromTo=t})(app||(app={}))