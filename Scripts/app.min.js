function isSmartPhone(){return navigator.userAgent.indexOf("iPhone")>0&&navigator.userAgent.indexOf("iPad")==-1||navigator.userAgent.indexOf("iPod")>0||navigator.userAgent.indexOf("Android")>0}isSmartPhone()&&(document.body.style.fontSize="20px"),angular.module("albus",[]).directive("autoComplete",function(){return function(n,t,i){n.$watch(i.uiItems,function(n){t.autocomplete({source:n,select:function(){setTimeout(function(){t.trigger("input")},0)}})},!0)}});var app;(function(n){var t=function(){function n(n,t){var i=this;this.showMap(n,t),n.busstops=[],t.jsonp("http://www9264ui.sakura.ne.jp/busstops/result_bts_lines?format=json&format=js&callback=JSON_CALLBACK").success(function(t){for(var r=0;r<t.busstops.length;r++)n.busstops.push(t.busstops[r].busstopname);i.busstopList=t.busstops,i.putMarkers()}),n.fromBusStop="昭和通り",n.toBusStop="五分一西",n.startTime=this.getNowTime(),n.resultDiagrams=[],n.search=function(){t.jsonp("http://www9264ui.sakura.ne.jp/diagrams/result?start_busstopnm="+encodeURIComponent(n.fromBusStop)+"&arrival_busstopnm="+encodeURIComponent(n.toBusStop)+"&departure_datetime="+i.getNowDate()+n.startTime+"&format=js&callback=JSON_CALLBACK").success(function(r){var e,u,f;n.resultDiagrams=[],e=r.diagrams[1].diagram.linename+" "+r.diagrams[0].diagram.avltime+" ⇒ "+r.diagrams[1].diagram.avltime,n.resultDiagrams.push(e),u=parseInt(r.diagrams[0].diagram.avltime,10)+1,f="",f=u<1e3?"0"+u:u.toString(),t.jsonp("http://www9264ui.sakura.ne.jp/diagrams/result?start_busstopnm="+encodeURIComponent(n.fromBusStop)+"&arrival_busstopnm="+encodeURIComponent(n.toBusStop)+"&departure_datetime="+i.getNowDate()+f+"&format=js&callback=JSON_CALLBACK").success(function(t){var i=t.diagrams[1].diagram.linename+" "+t.diagrams[0].diagram.avltime+" ⇒ "+t.diagrams[1].diagram.avltime;n.resultDiagrams.push(i)}).error(function(n){console.log("fail"),console.log(n)})}).error(function(n){console.log("fail"),console.log(n)}),i.map.addListener("center_changed",function(){})}}return n.prototype.putMarkers=function(){for(var n=0;n<this.busstopList.length;n++)this.busstopList[n].marker||(this.busstopList[n].marker=this.putMarker(this.busstopList[n]))},n.prototype.putMarker=function(n){var t=this,i=new google.maps.Marker({map:this.map,title:n.busstopname,position:new google.maps.LatLng(n.gps1,n.gps2),icon:"Images/busstop.png"}),r=new google.maps.InfoWindow({content:"<p>"+n.busstopname+"<\/p><button disabled='disabled' onclick=\"$('#id_fromBusStop').val('"+n.busstopname+"'); \">乗車<\/button><button disabled='disabled' onclick=\"$('#id_toBusStop'  ).val('"+n.busstopname+"'); \">降車<\/button>"});return google.maps.event.addListener(i,"click",function(){t.activeInfoWindow&&t.activeInfoWindow.close(),r.open(t.map,i),t.activeInfoWindow=r}),i},n.prototype.getNowTime=function(){var i=new Date,n="",r=i.getHours(),t;return r<10&&(n+="0"),n+=r.toString(),t=i.getMinutes(),t<10&&(n+="0"),n+t.toString()},n.prototype.getNowDate=function(){var t=new Date,n="",u=t.getFullYear(),i,r;return n+=u.toString(),i=t.getMonth(),i<10&&(n+="0"),n+=i.toString(),r=t.getMonth(),r<10&&(n+="0"),n+r.toString()},n.prototype.showMap=function(){var n=this,i=navigator.geolocation.watchPosition(function(t){var i=new google.maps.LatLng(t.coords.latitude,t.coords.longitude);n.map.setCenter(i),n.currentPosMarker||(n.currentPosMarker=new google.maps.Marker({map:n.map,title:"現在地",icon:"Images/male.png"})),n.currentPosMarker.setPosition(i)},function(n){switch(n.code){case 1:alert("位置情報の利用が許可されていません");break;case 2:alert("デバイスの位置が判定できません");break;case 3:alert("タイムアウトしました")}},{enableHighAccuracy:!0}),t={zoom:15,mapTypeId:google.maps.MapTypeId.ROADMAP};this.map=new google.maps.Map(document.getElementById("map_canvas"),t)},n.toggleMap=function(){var n=$("#map_canvas");n.css("display")==="none"?n.css("display","block"):n.css("display","none")},n}();n.searchBusByFromTo=t})(app||(app={}))